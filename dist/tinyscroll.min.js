!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b()}):"undefined"!=typeof module&&module.exports?module.exports=b():window[a]=b()}("TinyScroll",function(){"use strict";function a(a){this.options=$.extend({},a),this.initDate=null,this.minDate=null,this.maxDate=null,this.$wrapper=$(this.options.wrapper),this.$target=null,this.freezing=!1,this.moving=!1,this.curTopMap={},this.oriTopMap={},this.touchTime=0,this.touchY=0,this.timeGap=0,this.mTopLocked=!1,this.mBottomLocked=!1,this.dTopLocked=!1,this.dBottomLocked=!1,this.hhTopLocked=!1,this.hhBottomLocked=!1,this.mmTopLocked=!1,this.mmBottomLocked=!1,this.stateTree={year:this.options.year||0,month:this.options.month||0,day:this.options.day||0,hour:this.options.hour||0,minute:this.options.minute||0},this.stateCache={year:this.options.year||0,month:this.options.month||0,day:this.options.day||0,hour:this.options.hour||0,minute:this.options.minute||0},this.fnList={year:this.yearChanged,month:this.monthChanged,day:this.dayChanged,hour:this.hourChanged,minute:this.minuteChanged},this.init()}"ontouchstart"in window||alert("Error tips: You can't use the tinyscroll.js because your device does not support touch events."),$&&$===jQuery||alert("Error tips: Tinyscroll.js is dependen on jQuery! Make use jQuery has been loaded.");var b=30;return a.prototype={constructor:a,init:function(){if(this.initDate<this.minDate||this.initDate>this.maxDate)throw"Error: The `initDate` is error! Range is: ["+this.minDate+", "+this.maxDate+"]";this.dateInit(),this.render()},render:function(){var a=this;this.diffState(a.stateCache,a.stateTree);if(0!==this.$wrapper.children().length)return this.$wrapper.find(".tiny-scroll-backdrop").show(),void this.$wrapper.find(".tiny-scroll").removeClass("slideOutDown").addClass("slideInUp");var b=['<div class="tiny-scroll-backdrop"></div>','<div class="tiny-scroll slideInUp animated">',this.options.title?'<div class="ts-header">'+this.options.title+"</div>":"",'<div class="ts-body'+(this.options.time?" ts-datetime":"")+'">','<div class="ts-mask"></div>','<div class="ts-col ts-col-year">','<div class="ts-front"></div>',this.options.needLabel?"<em>年</em>":"",'<ul id="year" class="ts-item-list" data-target="year">'+this.generateList("year")+"</ul>","</div>",'<div class="ts-col">','<div class="ts-front"></div>',this.options.needLabel?"<em>月</em>":"",'<ul id="month" class="ts-item-list" data-target="month">'+this.generateList("month")+"</ul>","</div>",'<div class="ts-col">','<div class="ts-front"></div>',this.options.needLabel?"<em>日</em>":"",'<ul id="day" class="ts-item-list" data-target="day">'+this.generateList("day")+"</ul>","</div>",this.options.time?function(){return['<div class="ts-col">','<div class="ts-front"></div>',a.options.needLabel?"<em>时</em>":"",'<ul id="hour" class="ts-item-list" data-target="hour">'+a.generateList("hour")+"</ul>","</div>",'<div class="ts-col">','<div class="ts-front"></div>',a.options.needLabel?"<em>分</em>":"",'<ul id="minute" class="ts-item-list" data-target="minute">'+a.generateList("minute")+"</ul>","</div>"].join("")}():"","</div>",'<div class="ts-footer">','<div class="btns-wrapper">','<span class="ts-cancel-btn">'+(this.options.cancelValue?this.options.cancelValue:"Cancel")+"</span>",'<span class="ts-ok-btn">'+(this.options.okValue?this.options.okValue:"OK")+"</span>","</div>","</div>","</div>"].join("");this.$wrapper.append(b),this.attachEvents(),setTimeout(function(b){var c=a.initDate;a.setState({year:c.getFullYear(),month:c.getMonth()+1,day:c.getDate(),hour:c.getHours(),minute:c.getMinutes()}),$.extend(a.stateCache,a.stateTree)},300)},showScroller:function(){this.render()},hideScroller:function(){var a=this;this.setState(a.stateCache),this.$wrapper.find(".tiny-scroll").removeClass("slideInUp").addClass("slideOutDown"),this.$wrapper.find(".tiny-scroll-backdrop").hide()},dateInit:function(){var a=this.options.initDate,b=this.options.range[0],c=this.options.range[1];this.initDate=this.dateTranslate(a),this.minDate=this.dateTranslate(b),this.maxDate=this.dateTranslate(c)},dateTranslate:function(a){var b="string"==typeof a?new Date(a):a,c=b.getMinutes()%30;return c>30?function(){b.setHours(b.getHours()+1),b.setMinutes(0)}():function(){b.setMinutes(30)}(),b},getMonthDays:function(a,b){var c=a%4===0&&(a%100!==0||a%400===0),d=[31,28,31,30,31,30,31,31,30,31,30,31],e=[31,29,31,30,31,30,31,31,30,31,30,31];return c?e[b]:d[b]},formatDate:function(a,b,c,d,e){return a=parseInt(a||this.stateTree.year),b=parseInt(b||this.stateTree.month),c=parseInt(c||this.stateTree.day),d=parseInt(d||this.stateTree.hour),e=parseInt(e||this.stateTree.minute),this.options.time?a+"-"+(b>9?b:"0"+b)+"-"+(c>9?c:"0"+c)+" "+(d>9?d:"0"+d)+":"+(e>9?e:"0"+e)+":00":a+"-"+(b>9?b:"0"+b)+"-"+(c>9?c:"0"+c)},generateList:function(a){var b=this.minDate,c=this.maxDate,d=this.initDate,e="";switch(a){case"year":for(var f=parseInt(c.getFullYear()),g=parseInt(b.getFullYear()),h=0;h<=f-g;h++)e+='<li data-index="'+(g+h)+'">'+(g+h)+"</li>";break;case"month":for(var i=1;i<=12;i++)e+='<li data-index="'+i+'">'+i+"</li>";break;case"day":for(var j=1;j<this.getMonthDays(d.getFullYear(),d.getMonth())+1;j++)e+='<li data-index="'+j+'">'+j+"</li>";break;case"hour":for(var k=0;k<=23;k++)e+='<li data-index="'+k+'">'+k+"</li>";break;case"minute":for(var l=0;l<=30;)e+='<li data-index="'+l+'">'+l+"</li>",l+=30}return e},setState:function(a){for(var b in a)this.stateTree[b]>=0&&(this.stateTree[b]=a[b],this.fnList[b].call(this))},diffState:function(a,b){var c=!0;for(var d in a)if(a[d]!=b[d]){c=!1;break}return c},highlightSelected:function(a){var b=this.$wrapper.find("#"+a);b.find(".selected").removeClass("selected"),b.find('li[data-index="'+this.stateTree[a]+'"]').addClass("selected")},yearChanged:function(a){this.index2Pos(a,$(document.body).find("#year"),this.stateTree.year),this.monthListFix()},monthChanged:function(a){this.index2Pos(a,$(document.body).find("#month"),this.stateTree.month),this.dayListFix()},dayChanged:function(a){this.index2Pos(a,$(document.body).find("#day"),this.stateTree.day),this.hourListFix()},hourChanged:function(a){this.index2Pos(a,$(document.body).find("#hour"),this.stateTree.hour),this.minuteListFix()},minuteChanged:function(a){this.index2Pos(a,$(document.body).find("#minute"),this.stateTree.minute)},monthListFix:function(){var a=(this.$wrapper.find("#month"),this.maxDate),b=this.minDate,c=b.getMonth();if(this.stateTree.year==b.getFullYear())this.disablePrevItems("month",c+1),this.mTopLocked=!0,this.mBottomLocked=!1,this.stateTree.month<c+1&&this.setState({month:c+1});else{this.enablePrevItems("month"),this.mTopLocked=!1;var d=a.getMonth();this.stateTree.year==a.getFullYear()?(this.disableNextItems("month",d+1),this.mBottomLocked=!0,this.mTopLocked=!1,this.stateTree.month>d+1&&this.setState({month:d+1})):(this.enableNextItems("month"),this.mBottomLocked=!1)}this.dayListFix()},dayListFix:function(){var a=this.$wrapper.find("#day"),b=a.children().length,c=this.getMonthDays(this.stateTree.year,this.stateTree.month-1),d=this.maxDate,e=this.minDate,f=e.getDate();if(this.mTopLocked&&this.stateTree.month==e.getMonth()+1)this.disablePrevItems("day",f),this.dTopLocked=!0,this.dBottomLocked=!1,this.stateTree.day<f&&this.setState({day:f});else{this.enablePrevItems("day"),this.dTopLocked=!1;var g=d.getDate();this.mBottomLocked&&this.stateTree.month==d.getMonth()+1?(this.disableNextItems("day",g),this.dBottomLocked=!0,this.dTopLocked=!1,this.stateTree.day>g&&this.setState({day:g})):(this.enableNextItems("day"),this.dBottomLocked=!1)}if(c>b)for(var h=b+1;h<=c;h++)a.append('<li data-index="'+h+'">'+h+"</li>");else if(c<b){for(var i=0;i<b-c;i++)a.children().last().remove();a.children().last().data("index")<=this.stateTree.day&&this.setState({day:a.children().last().data("index")})}this.hourListFix()},hourListFix:function(){var a=(this.$wrapper.find("#hour"),this.maxDate),b=this.minDate,c=b.getHours();if(this.dTopLocked&&this.stateTree.day==b.getDate())this.disablePrevItems("hour",c),this.hhTopLocked=!0,this.hhBottomLocked=!1,this.stateTree.hour<c&&this.setState({hour:c});else{this.enablePrevItems("hour"),this.hhTopLocked=!1;var d=a.getHours();this.dBottomLocked&&this.stateTree.day==a.getDate()?(this.disableNextItems("hour",d),this.hhBottomLocked=!0,this.hhTopLocked=!1,this.stateTree.hour>d&&this.setState({hour:d})):(this.enableNextItems("hour"),this.hhBottomLocked=!1)}this.minuteListFix()},minuteListFix:function(){var a=(this.$wrapper.find("#minute"),this.maxDate),b=this.minDate,c=b.getMinutes();if(this.hhTopLocked&&this.stateTree.hour==b.getHours())this.disablePrevItems("minute",c),this.mmTopLocked=!0,this.mmBottomLocked=!1,this.stateTree.minute<c&&this.setState({minute:c});else{this.enablePrevItems("minute"),this.mmTopLocked=!1;var d=a.getMinutes();this.hhBottomLocked&&this.stateTree.hour==a.getHours()?(this.disableNextItems("minute",d),this.mmBottomLocked=!0,this.mmTopLocked=!1,this.stateTree.minute>d&&this.setState({minute:d})):(this.enableNextItems("minute"),this.mmBottomLocked=!1)}},disablePrevItems:function(a,b){var c=this.$wrapper.find("#"+a);c.children(".disable").removeClass("disable"),c.find('[data-index="'+b+'"]').prevAll().addClass("disable")},disableNextItems:function(a,b){var c=this.$wrapper.find("#"+a);c.children(".disable").removeClass("disable"),c.find('[data-index="'+b+'"]').nextAll().addClass("disable")},enablePrevItems:function(a){this.$wrapper.find("#"+a).children().prevAll(".disable").removeClass("disable")},enableNextItems:function(a){this.$wrapper.find("#"+a).children().nextAll(".disable").removeClass("disable")},attachEvents:function(){var a=this;this.$wrapper.on("click",".tiny-scroll-backdrop",function(b){a.hideScroller()}),this.$wrapper.on("touchstart touchmove touchend touchcancel",".ts-item-list",function(b){switch(this.$target=$(b.target).hasClass(".ts-item-list")?$(b.target):$(b.target).parents(".ts-item-list"),b.originalEvent.type){case"touchstart":a.touchStart.call(a,b,this.$target);break;case"touchmove":a.touchMove.call(a,b,this.$target);break;case"touchend":case"touchcancel":a.touchEnd.call(a,b,this.$target)}}),this.$wrapper.on("click",".ts-cancel-btn",function(){a.setState(a.stateCache),a.hideScroller()}),this.$wrapper.on("click",".ts-ok-btn",function(){$.extend(a.stateCache,a.stateTree),a.hideScroller(),a.options.okCallback&&"function"==typeof a.options.okCallback&&a.options.okCallback(a.formatDate())})},touchStart:function(a){if(!this.freezing){a.preventDefault();var b,c=$(a.target).parents(".ts-item-list");c.length&&(this.moving=!0,this.touchTime=a.timeStamp,this.curTopMap[c.data("target")]=this.curTopMap[c.data("target")]?this.curTopMap[c.data("target")]:0,b=a.originalEvent.touches[0].pageY,this.touchY=b-this.curTopMap[c.data("target")],this.moving=!0)}},touchMove:function(a,b){if(!this.moving)return!1;a.preventDefault();var c=a.originalEvent.touches[0].pageY;this.curTopMap[b.data("target")]=c-this.touchY,b.css("transform","translate3d(0px, "+this.curTopMap[b.data("target")]+"px, 0px)")},touchEnd:function(a,c){if(!this.moving)return!1;this.freezing=!0;var d=this,e=this.curTopMap[c.data("target")],f=e%b;f>0?function(){return e>2*b?(d.translateYUpdate(c,2*b),void d.touchEndEvent(a,c)):void(f>b/2?(d.translateYUpdate(c,e+b-f),d.touchEndEvent(a,c)):(d.translateYUpdate(c,e-f),d.touchEndEvent(a,c)))}():function(){var g=$(a.target).parents(".ts-item-list").outerHeight()-3*b;return Math.abs(e)>g?(d.translateYUpdate(c,-g),void d.touchEndEvent(a,c)):void(f<-(b/2)?(d.translateYUpdate(c,e-b-f),d.touchEndEvent(a,c)):(d.translateYUpdate(c,e-f),d.touchEndEvent(a,c)))}()},touchEndEvent:function(a,b){this.pos2Index(a,this.curTopMap[b.data("target")]),this.moving=!1,this.freezing=!1},translateYUpdate:function(a,b){var c=a.data("target");a.css("transform","translate3d(0px, "+b+"px, 0px)"),this.curTopMap[c]=b,this.highlightSelected(c)},pos2Index:function(a,c){var d=$(a.target).parents(".ts-item-list"),e=d.attr("id"),f=d.find("li").eq(2-c/b).data("index"),g=this.minDate,h=this.maxDate;switch(e){case"year":this.setState({year:f});break;case"month":this.mTopLocked===!0&&f<g.getMonth()+1?this.setState({month:g.getMonth()+1}):this.mBottomLocked===!0&&f>h.getMonth()+1?this.setState({month:h.getMonth()+1}):this.setState({month:f});break;case"day":this.dTopLocked===!0&&f<g.getDate()?this.setState({day:g.getDate()}):this.dBottomLocked===!0&&f>h.getDate()?this.setState({day:h.getDate()}):this.setState({day:f});break;case"hour":this.hhTopLocked===!0&&f<g.getHours()?this.setState({hour:g.getHours()}):this.hhBottomLocked===!0&&f>h.getHours()?this.setState({hour:h.getHours()}):this.setState({hour:f});break;case"minute":this.mmTopLocked===!0&&f<g.getMinutes()?this.setState({minute:g.getMinutes()}):this.mmBottomLocked===!0&&f>h.getMinutes()?this.setState({minute:h.getMinutes()}):this.setState({minute:f})}},index2Pos:function(a,c,d){var e=c.find('[data-index="'+parseInt(d)+'"]'),f=e.index(),g=f-2;this.translateYUpdate(c,-(b*g))}},a});